---
title: 1.搜索引擎是如何工作的
tags: 
notebook: 自制搜索引擎 
---

# 搜索引擎是如何工作的

## 1.理解搜索引擎的构成

### 什么是搜索引擎

---

* 搜索引擎是一类系统或软件的统称，作用是从文档的集合中查找（检索）出区配信息需求（查询）的文档，信息需求是由单次、问题等构成的。

* 本文所讲解的是全文搜索引擎，所谓的“全文”指的就是全部的句子，当检索的对象为“由文本构成的文档中的全部句子”时，对于该文档进行的检索就称为全文检索。而实现了这种全文搜索的系统就全文搜索引擎，`Full-text Search Engine`.

### 构成搜索引擎的组件

---

* 4个组件构成
  * 索引管理器（`Index Manager`）
  * 索引检索器（`Index Searcher`）
  * 索引构建器（`Indexer`）
  * 文档管理器（`Document Manager`）

![1](https://pic.downk.cc/item/5e31a38f2fb38b8c3cea925f.png)

* **索引管理器**
  * 索引管理器的**作用**管理带有索引结构的数据，索引结构是一种用于高速检索的数据结构。对索引的访问也是通过索引管理器进行的。
  * 索引管理器通常是将索引作为二级存储上的二进制文件来进行管理的。而且，通过保存经过压缩的索引来达到减少从二级存储加载的数据量，提升检索处理效率的目的。

* **索引检索器**
  * 索引检索器是利用索引进行全文搜索处理的组件。
  * 索引检索器根据来自检索应用程序用户的查询，协同索引管理器进行检索处理。
  * 在大多数情况下，索引检索器都会根据某种标准对于查询相匹配的检索结果排序，并将排在前面的结果返回个应用程序。
  * 所谓查询是指“由1个以上的单词或词组组成的对搜索引擎的询问”。

* **索引构建器**
  * 索引构建器是从作为检索对象的文本文档中生成索引的组件。
  * 索引构建器会先通过解析将文本文档分解为单词序列，然后再将该单词序列转换为索引结构。
  * 在搜索引擎中，将生成索引的环节称为**索引构建（`Index Construction`）**。

* **文档管理器**
  * 文档管理器是管理文档数据库的组件，文档数据库中储存着作为检索对象的文档。
  * 文档管理器会先从文档数据库中取出与查询相匹配的文档，然后再根据需要从该文档中提取出一部分内容作为摘要。
  * 文档管理器是对应着文档特定的`ID`（文档编号）来保存文档的内容。
  * 文档管理器有数据库管理系统（`DBMS`）、基于二级存储的数据库管理器（`DBM`）。
  * 由文档管理器管理的文档数据库既可以在构建索引的阶段随索引一同构建，也可以提前构建。

### 与搜索引擎相关的组件

---

* **爬虫**
  * 爬虫（`Crawler`）是用于收集`Web`上的`HTML`文件等文档的系统（机器人）。
  * 用于`Web`检索的爬虫就是通过追随Web页面上的超链接来收集全世界的HTML网页的。
  * 爬虫的任务就是高效地收集这些网页。

* **搜索排序系统**
  * 以`Google`的`PageRank`系统为代表的搜索排序系统是给作为检索对象的文档打分的系统
  * 在`Web`检索中，通常会以考量了查询与文档的关联性以及文档的热门度后得出的分数为基准，将检索结果排序后提供给应用程序的用户。
  * 搜索排序系统正是用于此目的、能（机械地）算出文档热门度的系统

## 2.实现了快速全文搜索的索引结构

### 全文搜索的两种方法

---

* **利用全扫描进行全文扫描**
  * 第一种方法是从头到尾扫描作为检索对象的文档，以此来搜索要检索的字符串
  * 由于字符串检索命令“`grep`” 也是以同样的方式进行搜索的，所以有时也将这种方法称为“`grep`型搜索”。
  * 不需要事先处理作为检索对象的文档
  * 文档数越多检索时间就越长
  * 一般认为这种方法只适用于处理少量或暂时性的文档
  * 其中也有一些高效的算法：`KMP`算法和`BM`算法

* **利用索引进行全文搜索**
  * 利用索引的方法，则需要事先为文档建立索引，然后利用索引来搜索要检索的字符串。
  * 虽然事先建立索引需要花费时间，但是优点是即时文档的数量增加，检索速度也不会大幅下降。
  * 一般认为这种方法更适合处理大量的文档。搜索引擎一般也会采用这种方法。
  * 虽然索引分为很多种，每种的结果不同，但是以`Google`和`Yahoo!`为代表的大多数搜索引擎采用的都是名为倒排索引的索引结构。

### 倒排索引的结构

---

* 在书后的索引中，通常都会写有关键词（单词）和出现了该关键词的页码。由于关键词是按词典顺序排列的，所以查找时无需逐一浏览，只需按照拼音字母的顺序逐渐缩小查找范围，就能轻松地找到关键词。
* 实际上，倒排索引具有与图书索引完全相同的逻辑结构。

* 示例

```
    第一页（P1）：I like search engines.
    第二页（P2）：I search keywords in Google.
```
表 1-1 示例书籍中的倒排索引
-|-
-|-
engine|P1
Google|P2
I|P1,P2
in|P2
keyword|P2
like|P1
search|P1,P2

### 倒排索引的构建方法

---

* 具体地看一看构建倒排索引的步奏
  * 首先，要以表格的形式归纳出书中的每一页都使用了哪些单词。请注意此时要将英文单词的复数形式还原为单数形式

    表1-2 表中列出了书中的哪一页使用了哪个单词
     
    -|I|like|search|engine|keyword|in|Google
    -|-|-|-|-|-|-|-
    P1|1|1|1|1|0|0|0
    P2|1|0|1|0|1|1|1

    表1-3 表中列出了书中的哪个单词出现在了哪一页上

    -|P1|P2
    -|-|-
    engine|1|0
    Google|0|1
    I|1|1
    in|0|1
    keyword|0|1
    like|1|0
    search|1|1
    
  * 实际上到了这个阶段，倒排索引就已经大致完成了。剩下的步奏就与制作图书的索引一样了，只要改用精简的表示方式，即只列出“每个单词都出现在了第几页上”
 
* 像这样，将表示“在哪一页上使用了哪个单词”的表格转换为“哪个单词出现在了哪一页上”的表格，就可以制作出倒排索引了。另外，之所以称这种索引为倒排索引，是由于刚刚进行过的交换表格行、列的操作叫作“倒排”。


### 倒排索引中的术语

---

* 在生成的倒排索引中，我们建立起了页中的单词和页的对应关系。
* 把页当成了构建索引的单位。
* 对于`Web`上的`HTML`文档。将1个`HTML`网页作为构建索引的单位
* 对于邮件，将1封邮件作为构建索引的单位

* 在全文搜索中，将构建索引的单位统称为“文档”（`Document`）,将文档的标识信息称为“文档标号”。
* 所谓**倒排索引**就是“把单词和单词所在文档的文档编号对应起来的表格”。

* 在倒排索引中，将表示单词和文档编号对应关系的信息称为**倒排项**（`Posting`）,将各个单词的倒排项的集合称为**倒排列表**（`Postings List`）。