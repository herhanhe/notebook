# Linux-day6 存储结构与磁盘划分

---

## 1.一切从“/”开始

* `Linux`系统中一切都是文件。
* `Linux`系统中的一切文件都是从“根（/）”目录开始的，并按照温文件系统层次化标准（`FHS，Filesystem Hierarchy Standard`）采用树形结构来存放文件，以及定义了常见目录的用途。
* `Linux`系统中的文件和目录名称是严格区分大小写的。

* `Linux`系统中常见的目录名称以及相应内容

    目录名称|应放置文件的内容
    -|-
    `/boot`|开机所需文件——内核、开机菜单以及所需配置文件等
    `/dev`|以文件形式存放任何设备与接口
    `/etc`|配置文件
    `/home`|用户家目录
    `/bin`|存放单用户模式下还可以操作的命令
    `/lib`|开机时用到的函数库，以及`/bin`与`/sbin`下面的命令要调用的函数
    `/sbin`|开机过程中需要的命令
    `/media`|用于挂载设备文件的目录
    `/opt`|放置第三方的软件
    `/root`|系统管理员的家目录
    `/src`|一些网络服务的数据文件目录
    `/tmp`|任何人均可使用的“共享”临时目录
    `/proc`|虚拟文件系统，例如系统内核、进程、外部设备及网络状态等
    `/usr/local`|用户自行安装的软件
    `/usr/sbin`|`Linux`系统开机时不会使用到的软件/命令/脚本
    `/usr/share`|帮助与说明文件，也可放置共享文件
    `/var`|主要存放经常变化的文件，如日志
    `/lost+found`|当文件系统发生错误时，将一些丢失的文件片段存放在这里

* 路径
  * 路径指的是如何定位到某个文件，分为绝对路径与相对路径。
    * 绝对路径（`absolute path`）:指的是从根目录（/）开始写起的文件或目录名称
    * 相对路径（`relative path`）:指的是相对于当前路径的写法。

## 2.物理设备的命名规则

* 系统内核中的`udev`设备管理器会自动把硬件名称规范起来，目的是让用户通过设备文件的名字可以猜出舍必大致的属性以及分区信息等；
* `udev`设备管系统的服务会一直以守护进程的形式运行并监听内核发出的信号来管理`/dev`目录下的设备文件。
* 常见的硬件设备及其文件名称
  
  硬件设备|文件名称
  -|-
  `IDE`设备|`/dev/hd[a-d]`
  `SCSI/SATA/U盘`|`/dev/sd[a-p]`
  软驱|`/dev/fd[0-1]`
  打印机|`/dev/lp[0-15]`
  光驱|`/dev/cdrom`
  鼠标|`/dev/mouse`
  磁带机|`/dev/st0 或 /dev/ht0`

* 硬盘设备
  * 一般的硬盘设备都会是以`/dev/sd`开头的。系统采用a~p来代表16块不同的硬盘（默认从a开始分配）
  * 硬盘分区的编号：
    * 主分区或扩展分区的编号从1开会，到4结束。
    * 逻辑分区从编号5开始。

    ![6-1](https://heh-1300576495.cos.ap-chengdu.myqcloud.com/UTOOLS1586186848761.png)

  * 扇区：硬盘设备是由大量的扇区组成的
    * 每个扇区的容量为512字节
    * 第一扇区最重要，它里面保存着主引导记录与分区表信息。
      * 主引导记录需要占用446字节，分区表为64字节，结束符占用2字节；
      * 其中分区表中每记录一个分区信息就需要16字节，
      * 这样一来最多只有4个分区信息可以写到第一扇区中，这4个分区就是4个主分区。

    ![6-2](https://heh-1300576495.cos.ap-chengdu.myqcloud.com/UTOOLS1586264016297.png)

    * 解决分区个数不足的问题，可以将第一扇区的分区表中16字节（原本要写入主分区信息）的空间（称之为扩展分区）拿出来指向另外一个分区。
    * 扩展分区，严格地讲它不是一个实际意义的分区，它仅仅是一个指向下一个分区的指针，这种指针结构将形成一个单向链表；
    * 逻辑分区，在扩展分区中创建出的，从而满足分区大于4个
    
     ![6-3](https://heh-1300576495.cos.ap-chengdu.myqcloud.com/UTOOLS1586423610326.png)

## 3.文件系统与数据资料

* 文件系统
  * 用户再硬件存储设备中执行的文件建立、写入、读取、修改、转存、与控制等操作都是依靠文件系统来完成的。
  * 作用是合理规划硬盘，以确保用户正常的使用需求。
  * 常见的文件系统：
    * Ext3：是一款日志文件系统，能够在系统异常宕机时避免文件系统资料丢失，并能自动修复数据的不一致与错误。
      * 当硬盘容量较大时，所需的修复时间也会很长
      * 不能百分之百保证资料不会丢失。
      * 他会把整个磁盘的每个写入动作的细节都预先记录下来，以便在宕机时能回溯追踪到被中断的部分，然后尝试进行修复。
    * Ext4：Ext3的改进版本，
      * RHEL6系统中的默认文件管理系统
      * 支持的存储容量高达1EB
      * 能够有无限多的子目录
      * 文件系统能够批量分配block块，从而极大地提高速写效率
    * XFS：是一种高性能的日志文件系统
      * RHEL7系统中的默认文件管理系统
      * 优势：在发生意外宕机后，既可以快速恢复可能被破坏的文件，而且强大的日志功能只用花费极低的计算和存储性能
      * 支持的存储容量高达18EB
* 数据
  * inode：Linux中记录每个文件的权限与属性
    * 每个文件占用一个独立的inode表格，大小默认128字节
    * 记录的信息：
      * 该文件的访问权限（read、write、execute）
      * 该文件的所有者与所属组（owner、group）
      * 该文件的大小（size）
      * 该文件的创建或内容修改时间（ctime）
      * 该文件的最后一次访问时间（atime）
      * 该文件的修改时间（mtime）
      * 文件的特殊权限（SUID、SGID、SBIT）
      * 该文件的真实数据地址（point）
  * block：文件的实际内容保存处
      *  block快大小（1KB、2KB、4KB）
      *  当文件的inode被写满后，Linux系统会自动分配出一个block块，专门用于像inode那样记录其他block块的信息，这样把各个block块的内容串到一起，就能够让用户读到完整的文件内容了。

* 虚拟文件系统（VFS Virual File System）
  * 为了使用户在读取或写入文件时不用关心底层的硬件结构
  * Linux内核中的软件层为用户提供了一个VFS接口
  * 用户实际上在操作文件时就是统一对虚拟文件系统操作

  ![6-4](https://heh-1300576495.cos.ap-chengdu.myqcloud.com/UTOOLS1586423620299.png)

## 4.挂载硬件设备
* 挂载
  * 当用户需要使用硬盘设备或分区中的数据时，需要先将其与一个已存在的目录文件进行关联，而这个关联动作就是“挂载”
* `mount`命令：用与挂载文件系统
  * 格式为“mount 文件系统 挂载目录”
  * 参数于作用：
  
    参数|作用
    -|-
    `-a`|挂载所有在`/etc/fstab`中定义的文件系统
    `-t`|指定文件系统的类型

  * 范例：
    ```shell
      mount /dev/sd2 /backup
    ```
* `/etc/fstab`文件：让硬件设备和目录永久地进行自动关联
  * 填写格式：“设备文件  格式类型  权限选项  是否备份  是否自检”
  
    字段|意义
    -|-
    设备文件|一般为设备的路径+设备名称，也可以写唯一识别码（`UUID，Universally Unique Identifier`）
    挂载目录|指定要挂载到的目录，需在挂载前创建好
    格式类型|指定文件系统的格式，比如`Ext3、Ext4、XFS、SWAP、iso9660（此为光盘设备）`等
    权限选项|若设置为`defaults`,则默认权限为：`rw、suid、dev、exec、auto、nouser、async`
    是否备份|若为1则开机后使用`dump`进行磁盘备份，为0则不备份
    是否自检|若为1则开机后自动进行磁盘自检，为0则不自检
  * 范例：
    ```shell
      [root@centos ~]# cat /etc/fstab

      #
      # /etc/fstab
      # Created by anaconda on Fri Mar  2 14:59:15 2018
      #
      # Accessible filesystems, by reference, are maintained under '/dev/disk'
      # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
      #
      UUID=74309cb6-4564-422f-bd07-a13e35acbb7a /                       xfs     defaults        0 0
      /dev/sdb2  /backup     ext4     defaults        0 0
      ```
* `umont`命令：卸载，用于撤销已经挂载的设备文件
  * 格式：“umount [挂载点/设备文件]”
  * 范例：
  ```shell
    [root@centos ~]# umount /dev/sdb2
  ```
## 5.添加硬盘设备
* `fdisk`命令：用于管理磁盘分区，它提供了集添加、删除、转换分区等功能与一身的“一站式分区服务”
  * 格式：“fdisk [磁盘名称]”
  * 参数：
    参数|作用
    -|-
    m|查看全部可用的参数